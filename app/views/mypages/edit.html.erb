<div class="mypage-container pt-32 max-w-xl mx-auto">
  <!-- „Éò„ÉÉ„ÉÄ„ÉºÈÉ®ÂàÜ -->
  <div class="header flex justify-between items-center mb-6">
    <h1 class="text-2xl font-bold">„Éû„Ç§„Éö„Éº„Ç∏Á∑®ÈõÜ</h1>
  </div>

  <!-- form_with „Çí1„Å§„Å´Áµ±‰∏Ä -->
  <%= form_with model: @user, url: mypage_path, method: :patch, local: true do |f| %>

    <!-- „É¶„Éº„Ç∂„ÉºÊÉÖÂ†±Á∑®ÈõÜÈÉ®ÂàÜ -->
    <div class="user-info mt-6 p-4 bg-gray-300 rounded-lg flex flex-col items-center">

      <div class="user-icon w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center mr-4 overflow-hidden">
        <% if @user.user_image.is_a?(CarrierWave::Uploader::Base) && @user.user_image.file.present? %>
          <%= image_tag @user.user_image.url, alt: "„É¶„Éº„Ç∂„Éº„Ç¢„Ç§„Ç≥„É≥", class: "w-full h-full object-cover" %>
        <% elsif @user.user_image.is_a?(ActionDispatch::Http::UploadedFile) %>
          <!-- „Ç¢„ÉÉ„Éó„É≠„Éº„Éâ‰∏≠„ÅÆ„Éï„Ç°„Ç§„É´„ÇíË°®Á§∫„Åó„Å™„ÅÑ -->
        <% else %>
          <span class="flex items-center justify-center w-full h-full text-sm text-center"><%= @user.name %></span>
        <% end %>
      </div>
      
      <div class="form-group mt-4" style="width: 100%; max-width: 19rem;">
        <%= f.label :name, "„É¶„Éº„Ç∂„Éº„Éç„Éº„É†", class: "text-sm text-gray-600" %>
        <%= f.text_field :name, class: "form-control mt-1 block w-full px-2 py-1 border border-gray-300 rounded" %>
      </div>
    
      <div class="form-group mt-4" style="width: 100%; max-width: 20rem;">
        <%= f.label :user_image, "„Éó„É≠„Éï„Ç£„Éº„É´ÁîªÂÉè", for: "user_image_input", class: "text-sm text-gray-600" %>
        <%= f.file_field :user_image, id: "user_image_input", class: "form-control mt-1 block w-full px-2 py-1 border border-gray-100 rounded" %>

        <%= link_to "ÁîªÂÉè„ÇíÊú™Ë®≠ÂÆö„Å´„Åô„Çã", reset_user_image_mypages_path(id: @user.id), method: :delete, class: "btn btn-danger mt-2 px-2 py-1 text-sm text-gray-600", data: { confirm: 'Êú¨ÂΩì„Å´ÁîªÂÉè„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü' } %>
      </div>
    </div>


    
    <!-- „Éó„É¨„Ç§„É§„Éº -->
    <div class="players-info mt-6">
      <h2 class="text-xl font-semibold flex items-center">
        <span class="material-icons mr-2">üë§</span>„Éó„É¨„Ç§„É§„Éº
      </h2>

      <%= f.fields_for :players, @players do |player_fields| %>
        <div class="player-card mt-6 p-4 bg-gray-100 rounded-lg flex flex-col items-center">
          <div class="player-details flex-grow">
            <div class="player-icon w-24 h-24 bg-gray-200 rounded-full flex items-center justify-center mr-4 overflow-hidden">
              <% if player_fields.object.player_image.present? %>
                <%= image_tag player_fields.object.player_image.url, alt: "„Éó„É¨„Ç§„É§„Éº„Ç¢„Ç§„Ç≥„É≥", class: "w-full h-full object-cover" %>
              <% else %>
                <span class="text-sm nickname-display"><%= player_fields.object.nickname || "Êñ∞„Åó„ÅÑ„Éó„É¨„Ç§„É§„Éº" %></span>
              <% end %>
            </div>

            <div class="form-group">
              <%= player_fields.label :nickname, "„Éó„É¨„Ç§„É§„Éº„Éç„Éº„É†", class: "text-sm text-gray-600" %>
              <%= player_fields.text_field :nickname, class: "form-control block w-48 px-2 py-1 mt-1 border border-gray-300 rounded nickname-input" %>
            </div>

            <div class="form-group mt-4">
              <%= player_fields.label :birth_date, "Ë™ïÁîüÊó•", class: "text-sm text-gray-600" %>
              <%= player_fields.date_field :birth_date, class: "form-control block w-48 px-2 py-1 mt-1 border border-gray-300 rounded" %>
            </div>

            <div class="form-group mt-4">
              <%= player_fields.label :gender, "ÊÄßÂà•", class: "text-sm text-gray-600" %>
              <%= player_fields.select :gender, options_for_select([['Áî∑„ÅÆÂ≠ê', 'male'], ['Â•≥„ÅÆÂ≠ê', 'female']]), class: "form-control block w-48 px-2 py-1 mt-1 border border-gray-300 rounded" %>
            </div>

            <div class="form-group mt-4">
              <%= player_fields.label :player_image, "„Éó„É¨„Ç§„É§„ÉºÁîªÂÉè", for: "player_image_input", class: "text-sm text-gray-600" %>
              <%= player_fields.file_field :player_image, id: "player_image_input", class: "form-control block w-full px-2 py-1 mt-1 border border-gray-300 rounded" %>

              <!-- ÁîªÂÉè„É™„Çª„ÉÉ„Éà„É™„É≥„ÇØ -->
              <% if player_fields.object.id.present? %>
                <%= link_to "ÁîªÂÉè„ÇíÊú™Ë®≠ÂÆö„Å´„Åô„Çã", reset_player_image_mypages_path(player_id: player_fields.object.id), method: :delete, class: "btn btn-danger mt-2 px-2 py-1 text-sm text-gray-600", data: { confirm: 'Êú¨ÂΩì„Å´„Éó„É¨„Ç§„É§„ÉºÁîªÂÉè„Çí„É™„Çª„ÉÉ„Éà„Åó„Åæ„Åô„ÅãÔºü' } %>
              <% end %>
            </div>

            <!-- ÂâäÈô§„Éï„É©„Ç∞„ÇíÁÆ°ÁêÜ -->
            <div class="form-group mt-4">
             <!-- Êó¢Â≠ò„ÅÆplayer„ÅÆÂâäÈô§„Éú„Çø„É≥ -->
           <% if player_fields.object.id.present? %>
              <%= link_to "ÂâäÈô§", "#", class: "btn btn-danger bg-red-500 text-white mt-4 px-3 py-1 rounded", onclick: "if(confirm('ÂâäÈô§„Åó„Å¶„Åó„Åæ„ÅÜ„Å®‰ªä„Åæ„Åß„ÅÆË®òÈå≤„ÅåÂÖ®„Å¶Ê∂à„Åà„Å¶„Åó„Åæ„ÅÑ„Åæ„Åô„ÄÇÂâäÈô§„Åó„Å¶„ÇÇ„Çà„Çç„Åó„ÅÑ„Åß„Åó„Çá„ÅÜ„ÅãÔºü')) { this.closest('div.player-card').querySelector('.destroy-flag').value = '1'; this.closest('form').submit(); } return false;" %>
              <%= player_fields.hidden_field :_destroy, class: "destroy-flag" %>
            <% else %>
              <!-- Êñ∞Ë¶è„Éó„É¨„Ç§„É§„Éº„ÅÆÂâäÈô§„Éú„Çø„É≥ -->
              <button type="button" class="remove-new-player-btn bg-red-500 text-white mt-4 px-3 py-1 rounded">ÂâäÈô§</button>
            <% end %>
            </div>

          </div>
        </div>
      <% end %>
    </div>


    <div class="form-group mt-6">
      <button type="button" id="add-player-btn" class="btn btn-secondary flex items-center">
        <svg class="h-8 w-8 text-gray-500 mr-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
        </svg>
        „Éó„É¨„Ç§„É§„Éº„ÇíËøΩÂä†„Åô„Çã
      </button>
    </div>

    <!-- ÂÆå‰∫Ü„Éú„Çø„É≥„Å®Êàª„Çã„Éú„Çø„É≥ -->
    <div class="form-group mt-6 text-right flex justify-between items-center">
      <!-- Êàª„Çã„Éú„Çø„É≥ -->
      <%= link_to 'Êàª„Çã', mypage_display_path, class: "bg-gray-100 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow" %>

      <!-- ÂÆå‰∫Ü„Éú„Çø„É≥ -->
      <%= f.submit 'ÂÆå‰∫Ü', class: "bg-white hover:bg-gray-100 text-gray-800 font-semibold py-2 px-4 border border-gray-400 rounded shadow ml-4" %>
    </div>
  <% end %>